{% extends 'base/base.html' %}
{% load static %}

{% block content %}
<div id="wrapper" style="max-width: 800px; margin: 20px auto; padding: 0 15px;">
    <!-- 分类标签（全部/求购/供应）：点击时保留搜索关键词 -->
    <div class="classification" style="margin: 20px 0;">
        <!-- 全部标签：带搜索参数q -->
        <a class="ui {% if not c %}red{% else %}gray{% endif %} label"
           href="{% if q %}{% url 'home' %}?q={{ q }}{% else %}{% url 'home' %}{% endif %}"
           style="margin-right: 10px;">
            全部
        </a>
        <!-- 求购标签：带分类c=1和搜索参数q -->
        <a class="ui {% if c == '1' %}red{% else %}gray{% endif %} label"
           href="{% if q %}?c=1&q={{ q }}{% else %}?c=1{% endif %}"
           style="margin-right: 10px;">
            求购
        </a>
        <!-- 供应标签：带分类c=0和搜索参数q -->
        <a class="ui {% if c == '0' %}red{% else %}gray{% endif %} label"
           href="{% if q %}?c=0&q={{ q }}{% else %}?c=0{% endif %}">
            供应
        </a>
    </div>

    <!-- 商品列表：修复按钮对齐问题 -->
    <div class="large ui middle aligned divided list">
        {% for item in product_list %}
        <!-- 使用Flex布局实现垂直居中对齐 -->
        <div class="item" style="display: flex; align-items: center; justify-content: space-between; padding: 15px; border-bottom: 1px solid #eee;">
            <!-- 左侧商品信息（图标+文字） -->
            <div style="display: flex; align-items: center;">
                <img class="ui avatar image" src="{% static 'img/ic_sell.png' %}">
                <div style="margin-left: 12px;">
                    <div style="font-size: 16px; font-weight: 500; margin-bottom: 5px;">
                        {{ item.title }}
                    </div>
                    <div style="color: #666; font-size: 13px;">
                        <span>{% if item.type == 0 %}供应{% else %}求购{% endif %}</span>
                        ·
                        <span>联系人：{{ item.contact|default:"未填写" }}</span>
                        ·
                        <span>{{ item.timestamp|date:"m-d" }}</span>
                    </div>
                </div>
            </div>

            <!-- 右侧“查看详情”按钮：垂直居中 -->
            <a class="small ui blue button" href="{% url 'app:detail' item.pk %}">
                查看详情
            </a>
        </div>
        {% empty %}
        <!-- 无数据时显示 -->
        <div style="text-align: center; padding: 50px 0;">
            <img src="{% static 'img/empty.png' %}" style="width: 100px; margin-bottom: 20px;" alt="暂无数据">
            <h3 style="color: #999;">
                {% if q %}
                    未找到包含“{{ q }}”的商品
                {% else %}
                    暂无相关商品信息
                {% endif %}
            </h3>
        </div>
        {% endfor %}
    </div>

    <!-- 分页导航：保留搜索和分类参数 -->
    {% if page_list %}
    <div class="ui pagination menu" style="margin: 20px auto; display: table;">
        {% for page in page_list %}
            {% if page == '...' %}
                <a class="icon item">{{ page }}</a>
            {% else %}
                <!-- 分页链接携带分类c和搜索q参数 -->
                <a class="item {% if page == page_obj.number %}active{% endif %}"
                   href="?page={{ page }}{% if c %}&c={{ c }}{% endif %}{% if q %}&q={{ q }}{% endif %}">
                    {{ page }}
                </a>
            {% endif %}
        {% endfor %}
    </div>
    {% endif %}
</div>
{% endblock content %}